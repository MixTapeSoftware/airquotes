<div class="min-h-screen ">
  <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-300">Upload Quotes</h1>
      <p class="mt-2 text-sm text-gray-500">Upload and process quotes</p>
    </div>

    <%= render 'upload_form' %>

    <div class="mt-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-medium text-gray-900">Your Quotes</h2>
        <div class="flex items-center space-x-4">
          <span class="text-sm text-gray-500" id="selected-count">0 quotes selected</span>
          <%= form_tag compare_quotes_path, method: :get, id: "compare-form" do %>
          <div id="selected-quotes"></div>
          <button type="submit" id="compare-button" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            Compare Selected
          </button>
          <% end %>
        </div>
      </div>

      <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="divide-y divide-gray-200">
          <% @quotes.each do |quote| %>
          <div class="p-4 hover:bg-gray-50">
            <div class="flex items-center space-x-4">
              <input type="checkbox" name="quote_ids[]" value="<%= quote.id %>" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded quote-checkbox" form="compare-form">
              <%= render 'quote_item', quote: quote %>
            </div>
          </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.quote-checkbox');
    const compareButton = document.querySelector('#compare-button');
    const selectedCount = document.querySelector('#selected-count');
    const compareForm = document.querySelector('#compare-form');
    const selectedQuotes = document.querySelector('#selected-quotes');

    function updateSelection() {
      const selected = document.querySelectorAll('.quote-checkbox:checked');
      selectedCount.textContent = `${selected.length} quote${selected.length !== 1 ? 's' : ''} selected`;
      compareButton.disabled = selected.length < 2;

      // Update hidden inputs for selected quotes
      selectedQuotes.innerHTML = '';
      selected.forEach(checkbox => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'quote_ids[]';
        input.value = checkbox.value;
        selectedQuotes.appendChild(input);
      });
    }

    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', updateSelection);
    });

    // Initial update
    updateSelection();

    // Debug form submission
    compareForm.addEventListener('submit', function(e) {
      const selected = document.querySelectorAll('.quote-checkbox:checked');
      console.log('Submitting form with quotes:', Array.from(selected).map(cb => cb.value));
    });
  });
</script>